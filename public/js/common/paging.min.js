/*! waboon - v2.0.0 - 2016-04-28
* Copyright (c) 2016 ; Licensed  */
define(function(require,exports,module){function a(a){var d=this;a=a||{};var e={page:a.page,url:a.url||"/",tpl:a.tpl||"",emptyTpl:a.emptyTpl||"",$loadMore:a.$loadMore||b("#load-more-record"),$targetContainer:a.$targetContainer||b("#container"),$listContainer:a.$listContainer,data:a.data||{},dataCallback:a.dataCallback,initCallback:a.initCallback,isLoop:a.isLoop||!1};if(e.$loadMore){if(e.page)e.data.page=e.page;else{var f=parseInt(e.$loadMore.data("currpage"))+1;e.isLoop&&d.maxpage<f&&(f=1),e.data.page=e.page=f}b.ajax({dataType:"Json",url:e.url,data:e.data,beforeSend:function(a){return c?(c=!1,"undefined"!=d.maxpage&&d.maxpage<e.page?(c=!0,!1):void e.$loadMore.text("正在加载中...")):!1},success:function(a){var b=a.data.data;if(!d.maxpage&&(d.maxpage=a.data.maxpage),1==parseInt(e.page)&&e.initCallback&&e.initCallback(d.maxpage,a),b&&Array.isArray(b)&&b.length){1==parseInt(e.page)&&(e.$listContainer?e.$listContainer.children().remove():e.$loadMore.prevAll().remove());var c=e.tpl;Mustache.parse(c),e.dataCallback&&e.dataCallback(b,d.maxpage,a);var f=Mustache.render(c,{items:b});e.$listContainer?e.$listContainer.append(f):(e.isLoop&&e.$loadMore.prevAll().remove(),e.$loadMore.before(f)),e.$loadMore.data("currpage",e.page),d.maxpage<=e.page?e.$loadMore.hide():e.$loadMore.text("加载更多...").show()}else 1==parseInt(e.page)?e.$targetContainer.html(e.emptyTpl):e.$loadMore.hide()},complete:function(){c=!0}})}}var b=require("../plugin/jquery.js");require("../plugin/mustache.min.js");var c=!0;module.exports={handle:a}});